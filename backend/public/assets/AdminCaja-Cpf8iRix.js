import{r as o,b as T,j as e,e as F,m as y,n as C,o as w,p as S}from"./index-C4kt10bM.js";function P(){const[c,k]=o.useState(()=>{const a=new Date;return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`}),[R,b]=o.useState({cuenta1:0}),[m,f]=o.useState({ingreso:0,egreso:0,retiro:0,aporte:0}),[r,u]=o.useState(""),[p,x]=o.useState({cuenta:"",importe:"",descripcion:""}),A=T(),[N,E]=o.useState([]),g=o.useRef(null);o.useEffect(()=>{document.body.style.overflow=r?"hidden":"auto"},[r]),o.useEffect(()=>{(async()=>{try{const[{data:s},{data:t},{data:i}]=await Promise.all([F(),y(c),C(c)]),n={...t};s.forEach(d=>{d.name in n||(n[d.name]=0)}),b(n),E(s),f(i)}catch(s){console.error("Error al cargar datos de caja:",s)}})()},[c]);const D=()=>{A("/admin")},h=a=>{u(s=>s===a?"":a),x({cuenta:"",importe:"",descripcion:""})},j=(a,s)=>{x(t=>({...t,[a]:s}))},I=async(a,s)=>{a.preventDefault();const{cuenta:t,importe:i,descripcion:n}=p,d=parseFloat(i);if(!t||isNaN(d)||d<=0){alert("Por favor completa todos los campos correctamente");return}try{s==="ingreso"?await w({name:"Ingreso",descripcion:n,amount:i,account:t}):s==="egreso"?await S({name:"Egreso",descripcion:n,amount:i,withdrawAccount:t}):s==="aporte"?await w({name:"Aporte",descripcion:n,amount:i,account:t}):s==="retiro"&&await S({name:"Retiro",descripcion:n,amount:i,withdrawAccount:t});const{data:v}=await y(c),{data:M}=await C(c);b(v),f(M),x({cuenta:"",importe:"",descripcion:""}),u("")}catch(v){console.error("Error al procesar transacción:",v),alert("Ocurrió un error al guardar el movimiento")}},l=a=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(a);return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"modal-overlay active",onClick:()=>u(""),children:e.jsxs("form",{className:"modal-formulario",onClick:a=>a.stopPropagation(),onSubmit:a=>I(a,r),children:[e.jsx("button",{type:"button",onClick:()=>u(""),style:{position:"absolute",top:"10px",right:"12px",background:"transparent",border:"none",fontSize:"20px",cursor:"pointer",color:"#999"},children:"×"}),e.jsxs("h3",{className:"page-title",children:["Registrar ",r.charAt(0).toUpperCase()+r.slice(1)]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cuenta"}),e.jsxs("select",{className:"input",value:p.cuenta,onChange:a=>j("cuenta",a.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar cuenta"}),N.map(a=>e.jsxs("option",{value:a.name,children:[a.name," - ",a.bank]},a._id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Importe"}),e.jsx("input",{type:"number",className:"input",step:"0.01",min:"0",value:p.importe,onChange:a=>j("importe",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descripción"}),e.jsx("textarea",{className:"input",rows:3,value:p.descripcion,onChange:a=>j("descripcion",a.target.value)})]}),e.jsx("button",{className:"btn",type:"submit",children:"Registrar"})]})}),e.jsxs("div",{className:"admin-container",children:[e.jsxs("div",{className:"admin-header",children:[e.jsxs("button",{onClick:D,style:{background:"rgba(31, 41, 55, 0.8)",border:"1px solid rgba(75, 85, 99, 0.5)",borderRadius:"8px",padding:"8px 12px",color:"#e5e7eb",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.background="rgba(55, 65, 81, 0.9)",a.target.style.borderColor="rgba(156, 163, 175, 0.7)"},onMouseLeave:a=>{a.target.style.background="rgba(31, 41, 55, 0.8)",a.target.style.borderColor="rgba(75, 85, 99, 0.5)"},children:[e.jsx("span",{style:{fontSize:"16px"},children:"←"}),e.jsx("span",{children:"Volver"})]}),e.jsx("div",{className:"titulo-profesional",children:"Caja"})]}),e.jsxs("div",{className:"card",children:[e.jsx("label",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:20,justifyContent:"center"},children:e.jsx("div",{onClick:()=>{var a,s,t;return((s=(a=g.current)==null?void 0:a.showPicker)==null?void 0:s.call(a))||((t=g.current)==null?void 0:t.focus())},style:{display:"inline-block",cursor:"pointer"},children:e.jsx("input",{ref:g,type:"month",value:c,onChange:a=>k(a.target.value),style:{pointerEvents:"none",width:"200px"}})})}),e.jsx("div",{children:N.map(a=>{const s=R[a.name]||0;return e.jsxs("div",{className:"cuenta-item",children:[e.jsx("h3",{children:a.name.toUpperCase()}),e.jsx("div",{className:"monto",children:l(s)})]},a._id)})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:`action-button deposit-button ${r==="ingreso"?"activo":""}`,onClick:()=>h("ingreso"),children:"Ingreso"}),e.jsx("button",{className:`action-button withdraw-button ${r==="egreso"?"activo":""}`,onClick:()=>h("egreso"),children:"Egreso"}),e.jsx("button",{className:`action-button aporte-button ${r==="aporte"?"activo":""}`,onClick:()=>h("aporte"),children:"Aporte"}),e.jsx("button",{className:`action-button logout-button ${r==="retiro"?"activo":""}`,onClick:()=>h("retiro"),children:"Retiro"})]})}),e.jsxs("div",{className:"card",style:{marginTop:"24px"},children:[e.jsx("h3",{className:"page-title",children:"Resumen Histórico"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px"},children:[e.jsxs("div",{className:"resumen-item ingresos",children:[e.jsx("h4",{children:"Total Ingresos"}),e.jsx("div",{className:"valor",children:l(m.ingreso)})]}),e.jsxs("div",{className:"resumen-item egresos",children:[e.jsx("h4",{children:"Total Egresos"}),e.jsx("div",{className:"valor",children:l(m.egreso)})]}),e.jsxs("div",{className:"resumen-item aportes",children:[e.jsx("h4",{children:"Total Aportes"}),e.jsx("div",{className:"valor",children:l(m.aporte)})]}),e.jsxs("div",{className:"resumen-item retiros",children:[e.jsx("h4",{children:"Total Retiros"}),e.jsx("div",{className:"valor",children:l(m.retiro)})]})]})]})]})]})}export{P as default};
